---
title: "Gas exchange in large rivers controlled by largest turbulent eddies: implications for remotely sensing gas exchange via SWOT"
author: 'CB Brinkerhoff, CJ Gleason, PA Raymond, MH Harlan'
date: "`r Sys.Date()`"
bibliography: References.bib
csl: agu_citation_style.csl
output:
  word_document: 
      reference_docx: word-styles-reference.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Key Points
- In large rivers, there exists a local equilibrium between production and dissipation of turbulent kinetic energy at the free surface
- Gas exchange in large rivers is equivalently parameterized across multiple turbulence scales in open-channel flows
- BIKER algorithm exploits this theory, predicting gas exchange velocity and $CO_2$ fluxes from simulated SWOT satellite data and in situ $CO_2$ data

##Keywords
gas exchange, open-channel flow, remote sensing, SWOT, biogeochemistry, ungauged basin

##Abstract
Go BIKER!!
*AGU Advances. So 250 words here*
*AGU advances is 8000 words total, though the format of the ones I've looked at vary quite a bit from long letter to short article. Many are clearly shorter than 8000 I think*

##Plain Language Summary
Necessary for AGU advances (200 words)

##1 Introduction
Since the publication of @colePlumbingGlobalCarbon2007a, the global river network is recognized to emit substantial amounts of carbon in addition to exporting to the oceans. Current estimates of total carbon dioxide ($CO_2$) evasion to the atmosphere from the global river network vary from 650-1800 Tg C/yr [@lauerwaldSpatialPatternsCO22015; @raymondGlobalCarbonDioxide2013a], with 167 Tg-C/yr coming from mountain streams alone [@horgbyUnexpectedLargeEvasion2019]. Despite its incredibly small percentage of the global land surface, this is on par with the total oceanic $CO_2$ uptake rate [@gruberOceanicSinkAnthropogenic2019] and the global forest carbon uptake rate [@panLargePersistentCarbon2011]. Though this flux is still relatively poorly constrained, it plays a critical role in the global carbon cycle and is of great interst to aquatic biogeochemists. Equation 1 represents this flux for any sparingly soluble gas given the gas concentration gradient between the water $C_{water}$ and the air $C_{air}$ and the gas exchange velocity *k*.

$$\mathbf{(1)} Flux=k(C_{water}-C_{air})$$

The structure of equation 1 necessitates that calculations of this flux are highly sensitive to one's measurements/estimates of *k*. More broadly, *k* is also of significant importanceto aquatic ecologists modeling stream metabolism [@bernhardtMetabolicRegimesFlowing2018], water quality engineers [@chapraSurfaceWaterQualityModeling2008], and general interfacial mass transport [@lorkeUnifiedScalingRelation2006]. Decades of work have focused on elucidating the physical mechanisms behind *k* in oceans and lakes and, to a lesser extent, fluvial gas exchange [see @wanninkhofAdvancesQuantifyingAirSea2009 and @hallGasExchangeStreams2020 for reviews on gas exchange in in oceans and rivers, respectively]. Given that *k* should scale with turbulence in a fluid flow, a generalized model for *k* (equation 2) relies on the characteristic turbulence velocity scale $v_K$, which itself is a function of the characteristic length and time scales [@katulStructureFunctionModel2018]. Extensive field and labratory experiments have confirmed the validity of this model when $v_K$ is set to the Kolmogorov velocity scale [e.g. @lamontEddyCellModel1970; @zappaEnvironmentalTurbulentMixing2007; @lorkeUnifiedScalingRelation2006; @zappaVariationSurfaceTurbulence2003 **MORE**], where the idea is that the turbulent kinetic energy (TKE) cascade necessitates that TKE is produced by the largest, integral-scale turbulent eddies in the flow and then passed down the cascade to progressively smaller eddies until it is dissipated as heat at the Kolmogorov-scale: the smallest eddies in a turbulent flow. Equation 2 via Kolmogorov-scale eddies can also be derived from both classic thin-film and surface renewal theories for gas exchange [@wangPhysicallyBasedScaling2021].
$$\mathbf{(2)} k\sim Sc^{-n}v_K$$

While this model works reasonably well in non-fluvial environments, there is considerable uncertainity in how it applies to fluvial systems. Specifically, the influence of the riverbed and its large roughness elements in small streams (i.e. rapids) complicates scaling fluvial *k* and might lead to substantially higher *k* in streams with whitewater [e.g. @hallAirWaterOxygen2012; @ulsethDistinctAirWater2019a]. Conversely, even less attention has been paid to the other side of the stream-to-river continumn, where large rivers' hydraulic properties begin to mimic small lakes and estuaries. To date, the handful of existing field studies of large-river *k* have suggested that their *k* properties begin to mimic small lakes with respect to wind dynamics, though little else is well-established [@alinPhysicalControlsCarbon2011; @beaulieuControlsGasTransfer2012a; @wangPhysicallyBasedScaling2021]. Further, these mechanistic uncertainties are additionally limited by a large dearth of field-measured fluvial *k*. @wangPhysicallyBasedScaling2021 attempted to address this by simulating *k* in 35 rivers using stream metabolism modeling [@applingOvercomingEquifinalityLeveraging2018] and in situ dissolved oxygen (DO) datasets, though this is still limited by the biases inherent in the DO data. This is all exacerbated in ungauged basins that cover large areas, especially in the carbon-rich Arctic inland waters, where little in situ information is available and fieldwork is impractical [@gleasonRemoteSensingRiver2020].

These mechanistic uncertainties are then propogated through upscaling workflows when biogeochemists predict *k* across thousands of rivers [e.g @borgesGloballySignificantGreenhousegas2015a; @horgbyUnexpectedLargeEvasion2019; @lauerwaldSpatialPatternsCO22015; @raymondGlobalCarbonDioxide2013a] using equation 3 coupled with hydraulic geometry (HG), or the scaling relationships between streamflow and river channel hydraulics [@leopoldHydraulicGeometryStream1953a]. It is currently not well understood how sensitive global estimates of fluvial gas evasion are to the specific hydraulic geometry model that is employed by the worker. Further, these approaches rely on either in situ discharge records or modeled streamflow which introduces either additional uncertainity or the problems associated with ungauged rivers.

A potential alternative to this upscaling approach is to directly estimate a river's hydraulic properties from remote sensing (RS) data. Remote sensing of river hydraulics is a burgeoning subfield within remote sensing of hydrology, often in service of remote sensing of river discharge (RSQ- see @gleasonRemoteSensingRiver2020 for a recent review). This is accomplished via two general approaches: 'gauged' methods which rely on in situ river data to calibrate one's method to the river(s) at hand and 'ungauged' techniques which focus on generalizability and global implementation in the service of merely improving existing knowledge in data-poor domains [@gleasonRemoteSensingRiver2020]. Many, but not all, of these ungauged approaches were developed in the context of the upcoming NASA/CNES/UKSA/CSA Surface Water and Ocean Topography (SWOT) satellite mission. SWOT is expected to launch in 2022 and provide the world's first global measurements of water surface extent and elevation at novel temporal resolutions. SWOT is a wide swath radar interferometer and will sample rivers every 1 to 7 days per 21 day repeat cycle. This yields an average sampling resolution of 11 days. It will measure rivers wider than 100m with a goal of expanding this to rivers at least 50m wide [@biancamariaSWOTMissionIts2016]. A decade of SWOT work has explored the multi-parameter problem of estimating the river hydraulic parameters of roughness and bathymetry from remote sensing to produce the SWOT discharge product [e.g. @andreadisConstrainingAssimilationSWOT2020d; @brinkerhoffConstrainingRemoteRiver2020a; @durandEstimatingReachaveragedDischarge2014a; @garamboisInferenceEffectiveRiver2015; @gleasonRetrievalRiverDischarge2014a; @garamboisVariationalEstimationEffective2020; @brissetAssimilationAltimetricData2018; @hagemannBAMBayesianAMHGManning2017a; @larnierRiverDischargeBathymetry2020a; @oubanasDischargeEstimationUngauged2018].

In this context, here we revist the fundamental mechanisms behind gas exchange in large rivers using a simple TKE budget balance and one of the largest available datasets of field-measured river hydraulics [@brinkerhoffReconcilingAtaStationAtManyStations2019] to answer the following question: does *k* behave fundamentally differently in large rivers versus other streams and how does this relate to the classical model used to explain gas evasion in non-fluvial aquatic systems (equation 2, section 3)? We exploit the findings from this simple analysis to develop a novel methodology that predicts *k* and its explicit uncertainity solely using SWOT observations (section 4). It requires no in situ inputs of any kind (although in situ data can be ingested and will improve results). We name the RS of $k_{600}$ algorithm BIKER, or the 'Bayesian Inference/Inversion of the $k_{600}$ Evasion Rate' and validate it for 47 SWOT-observable rivers from around the world using hydraulic models to produce SWOT-like data (as SWOT has not yet launched- section 2). We also quantify BIKER's sensitivity to the expected SWOT measurement errors on 17 of those rivers: while SWOT data represent a sea change in inland water monitoring, it is expected to have an approximately 10cm error in water surface elevation [@biancamariaSWOTMissionIts2016] as well as river width errors [@frassonExploringFactorsControlling2021]. Finally, we use previously published dissolved $CO_2$ data to represent a hypotetical in situ $CO_2$ sensor and compare the bulk carbon efflux from the 47 rivers as calculated using BIKER and previously published in situ techniques for predicting $k_{600}$.

##2 Data
Numerous datasets were used in this study. Please see Figure 1 for a map of the approximate locations for the data used in this study. We also provide a flowchart detailing the entire study as Figure S1.

![Figure 1: Map of the 47 hydraulic models and 1 timeseries of CO2 samples used in this study. Note that hydraulic model locations are approximate as most of the models are not geo-referenced. We additionally used over 530,000 discrete measurements of river channel hydraulics from across the continetal United States (Brinkerhoff et al. 2019) and over 700 gas exchange velocity measurements (Ulseth et al. 2019) that are not mapped here.](cache/maps/map_fin.jpg)

TKE and gas exchange theory (section 2) are explored using two datasets. First, we use a previously published compilation of field measurements that were originally made to calibrate United States Geological Survey (USGS) streamgauge rating curves and collected by @brinkerhoffReconcilingAtaStationAtManyStations2019. That dataset contains over 530,000 unique measurements of river channel velocity, width, depth, and discharge from across the continental United States. This is to our knowledge the largest collection of field measurements of river channel hydraulics and serves as the best dataset to calculate water surface TKE budgets. Second, we use the dataset from [@ulsethDistinctAirWater2019a] who measured and/or collected (from the literature) over 700 measurements of stream hydraulics and *k* and is, to our knowledge, the largest collection of field-measured river and stream *k*. This is also the dataset used to validate our *k* predictive models.

BIKER validation (section 4) was performed on 47 SWOT-simulated rivers. Because SWOT has yet to launch, it is standard practice to benchmark SWOT-related algorithms on "SWOT-like" data. These simulated rivers are simply river-reach-averaged hydraulic model outputs where the water surface heights and widths are labelled as RS observations and are used as the sole inputs to BIKER. Here, we use 47/51 rivers collected by @frassonExploringFactorsControlling2021 and @durandIntercomparisonRemoteSensing2016b. These are the two benchmarking studies that have explored RSQ algorithm performance for the SWOT mission. The approximate locations of these rivers are plotted in Figure 1, and please consult both of those papers for all of the hydraulic model specifications. Ultimately, the 47 rivers are spread across the United States, France, Italy, the United Kingdom, and Bangladesh. We omit three models from @durandIntercomparisonRemoteSensing2016b because they lack enough hydraulic information to calculate $U_\star$, which is necessary for algorithm validation (both Saint Lawrence River models and the Tanana River model).

To assess the influence of measurement error on BIKER's performance (section 4), we use the error model developed by @durandHowWillRadar2020a and implemented on 17/47 of the rivers by @frassonExploringFactorsControlling2021. Error in SWOT measurements will come from both the error tolerances intrinsic in the satellite data product as well as radar layover error. Layover error is the phenomenon when radar returns from different places arrive at the sensor at the same time, leading to taller landscape features appearing closer to the sensor than shorter landscape features that are the same horizontal distance from the sensor [@durandHowWillRadar2020a]. Width errors due to poor water classification are ignored as they were in @frassonExploringFactorsControlling2021.

For the $CO_2$ evasion and carbon efflux calculations (section 4), we use 26 bi-weekly dissolved $CO_2$ samples made by @beaulieuControlsGasTransfer2012a at one location in the Ohio River for one calender year from 2008-2009 (Figure S2). Note that this $CO_2$ data is for the Ohio River only but was applied to all 47 rivers (which includes multiple sections of the Ohio River). Because we are exclusively interested in the relative differences between $FCO_2$ estimates and not the raw fluxes themselves, any $CO_2$ data representative of SWOT-observable rivers was deemed acceptable.

##3 The TKE budget in large rivers and implications for scaling river gas exchange velocity
Turbulent flow is fundamental to fluvial geomorphology and open-channel flow and has been the subject of extensive research across scientific and engineering disciplines for over a century. Turbulent kinetic energy (TKE) is the energy generated and dissipated by the eddies created from the chaotic nature of turbulent flow. @nakagawaTurbulenceOpenChannel1993 outline the standard energy budget for TKE, at some depth *h*, for a 2-dimensional open-channel flow (equation 3). *G* is the TKE produced, $\epsilon$ is the TKE dissipated, $T_d$ is TKE transported from the riverbed via turbulent diffusion, and $V_d$ is TKE transported via viscous diffusion. See Appendix A for all variable descriptions and notation.
$$\mathbf{(3)} G+T_d+V_d=\epsilon$$

$\epsilon$ is frequently described as $\epsilon(h)=\frac{U_*^3}{h}$. However in rivers, which exhibit additional depth-scale shear due to downslope flow over 'macroroughness elements' (channel geometry, bars, meanders, etc.), energy dissipation occurs much more evenly over the flow depth than this parameterization allows for. It has been shown that, for rivers at least, a more appropriate dissipation model considers stream power (per unit weight water: $\epsilon_D = gSU$), which represents the energy dissipated by the total frictional resistance of the river reach's geometry [@moogStreamReaerationNonuniform1999]. This is often called 'energy dissipation via form-drag' in the literature, and is generally used to upscale *k* in rivers and streams [i.e. @raymondScalingGasTransfer2012a; @ulsethDistinctAirWater2019a]. All three of these studies have confirmed that $\epsilon_D$ is far greater than $\epsilon$ in rivers, therefore generating the majority of fluvial TKE dissipation.

We express *G* at the free surface in two different ways (equation 4) following @nakagawaTurbulenceOpenChannel1993 on the left and our derivation (detailed in Text S1) on the right. Looking at equation 4, it is readily apparent that $\frac{R_h}{H}$ will cancel out if they are equal. This occurs in most large and wide rivers and is a common assumption in hydraulic modeling. In this scenario, the following three statements must be true: 1) $G \approx gSU \approx \epsilon_D \approx \epsilon$, 2) $\epsilon(H) \neq \frac{U_*^3}{H}$, and 3) $T_d \approx 0$. If this "large river" condition is met, then additonal TKE transported from the riverbed is functionally zero and the TKE budget at the free surface is just stream power (per unit weight water). It also implies a local equilibrium bewteen TKE produced and TKE dissipated at the free surface. 
$$\mathbf{(4)} G=\frac{UU_*^2}{H}=gSU\frac{R_h}{H} $$

We test this hypothesis using the data from @brinkerhoffReconcilingAtaStationAtManyStations2019 and @ulsethDistinctAirWater2019a by plotting boxplots of $\frac{R_h}{H}$ ratios for over 531,000 different measurements of river hydraulics versus $\epsilon_D - G$. *G* is calculated as $\frac{UU_*^2}{H}$. Note that this term is equivalent to $T_d$ in equation 1 assuming that $V_d$ is neglibile at the free surface [@nakagawaTurbulenceOpenChannel1993]. In order to calculate when $R_h=H$, we round all ratios to 3 significant figures and set all ratios greater than or equal to 0.995 as $R_h=H$. If our hypothesis holds, then $\epsilon_D - G$ should be functionally zero only when $R_h=H$.

![Figure 2: Hydraulic radius/mean depth ratios (Rh/H) versus stream power per unit weight water - TKE production (eD-G, or equivalently, Td at the free surface) for our two datasets of field-measured river channel hydraulics. eD-G is functionally zero only when the Rh = H. This indicates that, when a river is large enough, the TKE energy budget is simply governed by stream power and TKE produced is equal to TKE dissipated. A local equilibrium of TKE is acheived, where energy generated by large-scale eddies is nearly equal to energy dissipated by the smallest scale eddies. In this figure, Rh/H bins contain between 92 and 138,307 measurements. ](cache/k600_theory/turbulence.jpg)

Figure 2, which plots this test, shows that $T_d$, or $\epsilon_D-G$, is generally three to four orders of magnitude less when $R_h=H$ than it is when $\frac{R_h}{H}$ is between 90-99% (median $T_d$ of  $10^{-7.29}$ versus $10^{3.84} \frac{J}{kg*s}$, respectively). When the $\frac{R_h}{H}$ ratio is very small (0-9%), this rises to a median value of $10^{-2.56} \frac{J}{kg*s}$. We deem the $\epsilon_D - G$ values when $R_h=H$ (which are generally $10^{-6}$ to $10^{-8} \frac{J}{kg*s}$) to be functionally zero. This indicates that, when a river is large enough, the TKE energy budget at the free surface is simply stream power per unit weight water and a local equilibrium of free-surface TKE is acheived, where energy produced via the largest scale (turbulent) eddies is equivalent to energy dissipated via the smallest scale (Kolmorogov) eddies. This idea of a local equilibrium is certainly not new, however this is to our knowledge the first confirmation that it happens naturally in most large rivers. From here on we refer to the $R_h=H$ river scenario as the 'large river' condition.

This finding as a significant impact on how we model *k* in these large rivers. Because the local equilibrium acheived during the 'large river condition' necessitates that $\epsilon$ is equivalent to *G* (Figure 2), we can presumably set $v_K$ equal to the largest ('integral-scale') eddies in the system, which are much more easily remotely-sensible than the Kolmogorov velocity scale. Otherwise, *k* should continue to scale only using the Kolmogorov-scale (which is similar across all turbulent flows by its definition).

To test this hypothesis, we fit the following three models to the @ulsethDistinctAirWater2019a dataset of *K* measurements all normalized to a Schmidt number of 600: $k_{600}=\beta U_*$, $k_{600}=\alpha \epsilon^{1/4}$, and $k_{600}=a (\epsilon_D)^b$ under two scenarios: $R_h=H$ and $R_h =/= H$. Note that because all data are normalized to a Schmidt number of 600, both the Schmidt numbers and viscosity terms are constant and are implicit in the statistical coefficient. The model structures (and the fit parameters) are detailed in Table 1. The third model tested (rows 5 and 6 of Table 1), was fit to see which slope coefficient arrives empirically by fitting the generalized scaling function to the data. Therfore, the $r2$ for these models is reflective of the log-transformed $k_{600}$ (unlike the other two models). This was the approach used by @ulsethDistinctAirWater2019a, who argue that bubble-mediated gas exchange yields steeper slopes (in high-energy streams) than 0.25.

![Figure 3: Six k600 predictive models tested on the dataset from Ulseth et al. (2019). a-c are fit to the 'large river condition' while d-f are not. Red coefficients of determination refer to log-tranformed quantities while blue coefficients of determination refer to the natural quantities.](cache/k600_theory/k600Plot.jpg)

The results of this test are presented as Figure 3 and Table 1, where our hypothesis is confirmed: both the $U_*$ and $\epsilon^{1/4}$ models explain ~70% of variance in *k* under the 'large river' condition while the $U_*$ model does not work when this condition is not met ($r^2$:`r round(models_ustar[2,]$r2,2)` versus $r^2$=`r round(models_ustar[1,]$r2,2)`). In fact, Figures 3a and 3b are nearly identical in their scaling dynamics, while Figures 3d and 3e are very different, lending further evidence that these two scaling models are synonmous only when the 'large river' condition is met. @wangPhysicallyBasedScaling2021 also found similar predictive performance for their $k\sim U_*$ model on simulated data for 35 rivers where they assumed $R_h \approx H$ (reported $r^2$:0.76). Further, the 1/4 slope parameter is statistically recovered in the 'large river' condition (row 3, Table 1: slope = `r round(models_ulseth[2,]$slope,2)`). We note that the large residuals in Figure 3c are a byproduct of the model existing in log-space and that panels 3b and 3c are functionally identical (see Table 1 for their nearly identical intercept and slope parameters). The top row of Figure 3 confirms that under the 'large river condition' *k* can be scaled using either integral or Kolmogorov turbulence scales and that they are synonymous. This opens the door for remotely sensing *k* using almost entirely remotely-sensed parameters (section 4).

*Table 1: Model performance and parameter values for the six models tested*

|**Figure 3 Panel**|**River Regime**|**Theoretical Model**|**Model Structure**|**r2**|**Intercept Parameter**|**Slope Parameter**|
|---------------------|------------------|-------------------|------|---------------|---------------|------------------|
|3a|$R_h=H$|$k \sim Sc^{-n}U_*$|$k_{600}=\beta U_*$|`r round(models_ustar[2,]$r2, 2)`|`r round(models_ustar[2,]$int, 2)`|`r round(models_ustar[2,]$slope, 2)`|
|3d|$R_h=/=H$|$k \sim Sc^{-n}U_*$|$k_{600}=\beta U_*$|`r round(models_ustar[1,]$r2, 2)`|`r round(models_ustar[1,]$int, 2)`|`r round(models_ustar[1,]$slope, 2)`|
|3b|$R_h=H$|$k\sim Sc^{-n}(\epsilon)^{1/4}$|$k_{600}=\alpha(\epsilon_D)^{1/4}$|`r round(models_eD4[2,]$r2, 2)`|`r round(models_eD4[2,]$int, 2)`|`r round(models_eD4[2,]$slope, 2)`|
|3e|$R_h=/=H$|$k\sim Sc^{-n}(v\epsilon)^{1/4}$|$k_{600}=\alpha(\epsilon_D)^{1/4}$|`r round(models_eD4[1,]$r2, 2)`|`r round(models_eD4[1,]$int, 2)`|`r round(models_eD4[1,]$slope, 2)`|
|3c|$R_h=H$|$k\sim Sc^{-n}(v\epsilon)^b$|$k_{600}=a(\epsilon_D)^{b}$|`r round(models_ulseth[2,]$r2, 2)`|`r round(models_ulseth[2,]$int, 2)`|`r round(models_ulseth[2,]$slope, 2)`|
|3f|$R_h=/=H$|$k\sim Sc^{-n}(v\epsilon)^b$|$k_{600}=a(\epsilon_D)^{b}$|`r round(models_ulseth[1,]$r2, 2)`|`r round(models_ulseth[1,]$int, 2)`|`r round(models_ulseth[1,]$slope, 2)`|

The 1/4 exponent is clearly not valid when $R_h=/=H$ (Figure 3b). However, the generalized form of this model explains 73% of the variation in log-transformed *k* and was deemed a strong scaling model for fluvial *k* when rivers do not meet the 'large river' condition. That model yields a slope of `r round(models_ulseth[1,]$slope,2)` which corroborates other models with slopes steeper than 1/4 in rivers [@wangPhysicallyBasedScaling2021; @ulsethDistinctAirWater2019a; @raymondScalingGasTransfer2012a]. Further theoretical modeling is needed to parse out why fluvial *k* in smaller, steeper systems generally scales at a steeper rate than in non-fluvial systems, and how this relates to the breakpointed model proposed by @ulsethDistinctAirWater2019a.

##4 Extending this finding to remotely sense riverine gas exchange velocity via the BIKER algorithm
We have shown that scaling *k* by either integral or Kolmogorov turbulence scales explains ~70% of the variation in $k_{600}$ in large rivers. The integral-scale model relies solely on the shear velocity $U_*$. Because of the structure of $U_*$ (Appendix A), we can easily reduce the 'large river' $k_{600}$ model (Figure 3a, row 1 Table 1) to an equation consisting solely of remotely-sensible river hydraulics and an inferred estimate of the channel area. By scaling *k* this way, we significantly reduce potential equifinality issues by having just two unknowns: $k_{600}$ and the median channel area $A_0$. Equifinality refers to an under-constrained mathematical system that has essentially infinite parameter combinations that can produce the same result: there are in essence more unknowns than equations [@garamboisInferenceEffectiveRiver2015]. This problem is experienced by both SWOT RSQ algorithms and existing in situ techniques that concurrently solve for *k* and stream metabolism [@applingOvercomingEquifinalityLeveraging2018; @graceFastProcessingDiel2015; @holtgrieveSimultaneousQuantificationAquatic2010]. In both of these domains, the other parameters are quite difficult to estimate (bed roughness and stream metabolism, respectively) while for BIKER, median channel area is relatively easy to estimate from the SWOT-observable river width [@brinkerhoffConstrainingRemoteRiver2020a].

That said, this all assumes that the 'large river' condition is met. Because SWOT will be limited to the widest rivers on Earth (minimum average width of 100m), the $R_h=H$ assumption is nearly always valid. First, we verified that this is true using both the @brinkerhoffReconcilingAtaStationAtManyStations2019 and @ulsethDistinctAirWater2019a datasets (Figure S3), finding that the vast majority of rivers with a width of at least 100m exhibit this $R_h=H$ behavior. Thus, our theoretical findings in sections 2 and 3 should hold in nearly all rivers that SWOT will observe and we should be able to remotely estimate $k_{600}$. BIKER is informed by the @hagemannBAMBayesianAMHGManning2017a algorithm for ungauged RSQ, further explored in more recent work by @brinkerhoffConstrainingRemoteRiver2020a. These papers conceptualize discharge as a Bayesian remote sensing problem, which we largely follow here to conceptualize $k_{600}$ as a Bayesian remote sensing problem that can be solved using SWOT data.

BIKER, and Bayesian inference in general, starts from Bayes rule (equation 5), where $\Theta$ is some set of non-remotely-sensible parameters we want to solve for (including $k_{600}$), *x* is the observed data, $f(x|\Theta)$ is the 'likelihood function' or sampling model conditional on the parameters, and $p(\Theta)$ is the joint prior distribution of the parameters. Therefore, we are interested in solving for $p(\Theta|x)$, or the 'posterior' distribution. For BIKER, *x* is the SWOT-observables: river width *W* and water surface elevation *H* (which is used to calculate the water surface slope $_h$). Note that $p(x)$ is usually computationally intractable to integrate, so Bayesian inference tools require only the proportionality to be specified: $p(\Theta|x) \propto f(x|\Theta)p(x)$. Sampling algorithms are then used to approximate the posterior distribution, as is done in BIKER.

$$\mathbf{(5)} p(\Theta|x) = \frac{f(x|\Theta)p(\Theta)}{p(x)}$$

The heart of BIKER is its reformulation of the $k_{600}$ model as a Bayesian sampling model that is conditional only on the data that SWOT will provide. To do this, $k_{600}$ first needs to be written as a function of SWOT-observables *W* and $S_h$. This algebra is carried out using the model parameter from row 1 of Table 1 and yields equation 6, where we follow our earlier assumption that $R_h = H =\frac{A}{W}$ where *A* is wetted channel area. *A* is further split into the SWOT-observable portion *dA* and the unobservable portion $A_0$ following @durandEstimatingReachaveragedDischarge2014a. *dA* is estimated assuming a rectangular river channel (usually valid when $R_h=H$) so that $dA \approx \delta H*W$. As mentioned earlier, equifinality issues are limited in this model as there is only one unknown besides $k_{600}$, and $A_0$ is reasonably easy to approximate from river width [@brinkerhoffConstrainingRemoteRiver2020a]. There are no reliances on bed roughness, flow velocity, or any other terms that are difficult to infer from river width.

$$\mathbf{(6)} \begin{eqnarray} k_{600} = \bigg(56.0294 S_h(\frac{A_0+dA}{W})\bigg)^{1/2} \end{eqnarray}$$

Next, equation 6 is written as a Bayesian sampling model, in which all of the SWOT observations are sampled from the unknown model parameters ($A_0$ and $k_{600}$). This is equation 7 after log-transforming all of the variables. The $\sigma_{k_{600}}^2$ parameter refers to the uncertainty inherent in equation 6's estimates. Equation 7 also necessitate that we specify prior distributions for the parameters $A_0$ and $k_{600}$. Prior distributions, defined by their hyperparameters, formalize the a priori estimates (and uncertainties) for the non-remotely-sensed terms. More intuitively, BIKER priors represent our 'prior river knowledge' of what $A_0$ and $k_{600}$ probably are for some river since they cannot be remotely sensed. Hyperparameter specifications are detailed in Text S2, however the goal was to rely on absolutely no in situ information such that we could run this method on any river on Earth that is SWOT-observable.

$$\mathbf{(7)} \left[log(56.0294) + \frac{1}{2}log(g) + \frac{1}{2}log(S_h) - \frac{1}{2}log(W)\right] \sim normal\left(\left[log(k_{600})-\frac{1}{2}log(A_0+dA)\right], \sigma^2_{k_{600}}\right)$$

With the sampling model (equation 7) and hyperparameters described (Text S2), a joint posterior distribution conditional on the SWOT observations is specified. To approximate this distribution, we use a Markov Chain Monte Carlo (MCMC) algorithm implemented using the Stan probabilistic programming language. Specifically, Stan uses a Hamiltonian Monte Carlo sampler which reduces computation time relative to other sampling algorithms [@hagemannBAMBayesianAMHGManning2017a].

We validate BIKER on 47 SWOT-simulated rivers using daily observed $R_h$ and observed $S_h$. We also re-validate BIKER on the 17 rivers with the SWOT error model corrupting the SWOT-observables *W* and *H* (this workflow and the metrics used are detailed in Text S4). Regardless of the validation setup, we do not have observed $k_{600}$ data for these rivers, and to our knowledge no field dataset of $k_{600}$ exists in the type of temporal and spatial frequency that SWOT (and therefore the BIKER algorithm) provides. Therefore, we take the model outlined in row 1 of Table 1 and use that to calculate the observed $k_{600}$ that BIKER is validated against. With this setup, we are directly exploring BIKER's ability to infer observed $A_0$ and $k_{600}$ from *W* and *H* alone, as the model has already been sucessfully validated (Table 1, Figure 3).

Figure 4a plots the validation results for $k_{600}$ (with no SWOT measurement error) across all  rivers and all timesteps. The points are the posterior means while the black lines are the 95% confidence intervals (CIs) for the predictions. $k_{600}$ is strongly correlated with the BIKER-predicted $k_{600}$ ($r^2$ of 0.76). Using absolutely no in situ information, BIKER captures the magnitude of the predictions and most points fall on or near the 1:1 line. The regression of the estimates (solid grey line) nearly perfectly recovers the 1:1 line (dashed black), but there is an overestimation bias in the largest $k_{600}$ values. The RMSE for the BIKER predictions is `r round(results_3_2_all$rmse,2)` m/day) across all observations.

![Figure 4. a: Validation of BIKER for 47 SWOT rivers. Black bars are 95% CIs for the modeled values. Grey line is linear regression (and 95% prediction intervals are dashed) and dashed black line is 1:1 line. b: Cumulative density functions (CDFs) of the same results: dashed black line are observed values, green line are BIKER posterior means, and blue lines are BIKER 95% CIs.](cache/validation/validation.jpg)

Figure 4a highlights a overestimation bias by BIKER when $k_{600}$ is larger, which is confirmed in Figure 4b. Figure 4b plots the cumulative density functions (CDFs) of observed and predicted $k_{600}$ where the green line is the CDF of the BIKER posterior means, the blue lines are the CDFs of the BIKER posterior 95% CIs, and the dashed black line is the CDF of observed $k_{600}$. We see, more clearly than in Figure 4a, that BIKER captures $k_{600}$ very well: most of the  observed CDF falls nearly exactly on or adjacent to the posterior means (Figure 4b). However, the uppermost quartile is systematically overestimated by BIKER (also visible in Figure 4a). We propose that this is due to the model used to assign the $k_{600}$ prior hyperparameters being less representative for these rivers. In line with this, the rivers with the poorest BIKER performance uniformally are the narrowest and steepest in the set (Figure S4). In summary, Figure 3 confirms that we improve upon our baseline understanding of $k_{600}$ in these rivers: we accurately capture $k_{600}$ with no in situ information about the river while simultaneously and explicitly accounting for the uncertainties inherent in our $k_{600}$ estimates.

Figure 5a plots validation metrics calculated for each river with and without SWOT measurement error (green and purple, respectively). The boxplots are composed of validation scores for either the 47 or 17 rivers- see Table S1 for metric definitions. SWOT measurement errors neglibly influence BIKER's performance across all four error metrics (Figure 5a), though caution should be used in over-interepting boxplots with a sample size of only 17. Given Figure 5a, we deem that SWOT measurement error does not exert a significant influence on BIKER and so the results presented for the rest of the manuscript assume no measurement error in order to use all 47 rivers.

![Figure 5. a: Performance metrics by river. See Table 1 for metric definitions. Dashed lines denote scores of 1, 0, and -0.41 for r2 (section 3.2). b-d: validation timeseries for three rivers representative of good, reasonable, and poor BIKER performance. b) was randomly selected from the upper tertile of NRMSE scores, c) was randomly selected from the middle tertile, and d) from the worst tertile. Model results include the posterior means and 95% CIs.](cache/validation/validation_by_river.jpg)

Median r2 is `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$r2, na.rm=T),2)`, which is excellent given that absolutely no in situ information is being used to predict $k_{600}$. NRMSE and RRMSE have median scores of `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$nrmse, na.rm=T),2)` and `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rrmse, na.rm=T),2)`, respectively, which are again good for a completely ungauged method. Median rBIAS is `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rBIAS, na.rm=T),2)`, highlighting a  positive bias in most rivers' predictions. This further supports the visual evidence in Figure 4 that sometimes BIKER is overestimating the magnitude of $k_{600}$ and that this might be river-specific. While median r2 and rBIAS scores were strong, the ranges of these scores were somewhat large (standard deviation for r2 of `r round(sd(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$r2, na.rm=T),2)` and for rBIAS of `r round(sd(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rBIAS, na.rm=T),2)`).

Figure 5b-d are representative timeseries plots of predicted and observed $k_{600}$ for three rivers chosen randomly from those with 'good' NRMSE scores (b), 'okay' NRMSE scores (c), and 'bad' NRMSE scores (d). See the Figure 5 caption for how this was determined. For the Ohio Section 2 River, the entire timeseries of $k_{600}$ is nearly perfectly predicted, while in the Seine Upstream River the dynamics (peaks and valleys) are reasonably captured but they are magnified to be far larger than the observed dynamics. Generally, though, mean $k_{600}$ is actually reasonably recovered for the Seine Upstream, as confirmed visually. In the Connecticut River, there is significant positive bias in the estimates but also massive uncertainty (per the 95% CIs) in those estimates, indicating that BIKER is highly uncertain about its output (and rightfully so). Correct temporal dynamics are also largely missing from BIKER's Connecticut River predicitions.

##5 Remotely sensing carbon emissions from rivers
It is one thing to accurately predict *k*, but researchers are often most interested in the actual gas fluxes from rivers and ultimately the carbon emitted from river to atmosphere. Therefore, we also explore 1) BIKER's ability to reproduce $CO_2$ evasion fluxes ($FCO_2$ $[M/L^2T]$) from these 47 rivers, and 2) a comparison of the representative carbon efflux $[M/T]$ from BIKER with eastbalished in situ methods. The details of this workflow are in Text S4, but broadly we pair the biweekly 26 $CO_2$ samples (section 2, figure S2) from @beaulieuControlsGasTransfer2012a with a subset of SWOT observations (as the data are not daily). We then calculate $FCO_2$ using the equation 7 and assuming atmospheric $CO_{2_{air}}$ is 390 uatm. Finally, we estimate a median bulk carbon efflux using BIKER's posterior means and three other in situ models for average channel depth (used to calculate $U_\star$) used for upscaling: one trained on the @brinkerhoffReconcilingAtaStationAtManyStations2019 dataset, and two previously published models [@raymondGlobalCarbonDioxide2013a; @raymondScalingGasTransfer2012a]. See Table S2 for their definitions. This allows us to assess whether BIKER's estimates (wholly ungauged) are comparable to gauged methods (all four HG models). Finally, we express the bulk carbon efflux as the median mass flow rate of carbon (via $CO_2$ evasion) per year from the 47 rivers after accounting for total river surface area.

$$\mathbf{(7)} FCO_2 = k_{CO_2}([CO_{2_{water}} - [CO_{2_{air}}])$$

In Figure 6a, there is a very strong fit to the observed $FCO_2$ data, with an RMSE of `r round(results_3_3_all$rmse,2)` $g/m^2dy$. The performance is notably better than for $k_{600}$ alone (Figure 4a) and there is no systematic bias in the predicitons across all 47 rivers. This is presumably due to the structure of the $FCO_2$ equation, which reduces the relative importance of errors in *k* given that the $CO_2$ data is measured in situ. $FCO_2$ prediction intervals are slightly narrower than those presented in Figure 4a.

![Figure 6: a: FCO2 via BIKER versus via equations 2 and 3 for every 11th timestep for the 49 rivers (grey lines are linear regression and 95% prediction intervals, while black dashed line is the 1:1 line). b-d: timeseries plots for the three example rivers from Figure 3b, 3c, and 3d.](cache/FCO2/FCO2_models.jpg)

Figure 6b compares the bulk carbon efflux (via $CO_2$ evasion) from the 47 rivers using BIKER posterior means and four streamgauge-based HG models. Both the BIKER bulk carbon efflux (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_BIKER',]$sumFCO2, 0)` gG-C/yr) and the 'Brinkerhoff 2019' estimate (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_brinkerhoff2019',]$sumFCO2, 0)`) are quite close to the observed flux (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_obs',]$sumFCO2, 0)`), with the latter nearly perfectly recovering the observed value. BIKER overestimates the efflux somewhat. The 'raymond 2013' model is even more overestimated (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_raymond2013',]$sumFCO2, 0)`), while the 'Raymond 2012' model appreciably underestimates this bulk efflux (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_raymond2012',]$sumFCO2, 0)`). Thus, despite BIKER using absolutely no in situ data like the other 4 methods do, it provides a reasonable estimate of the carbon efflux and better a estimate than 2 of the approaches that rely on a streamgauge (Figure 6b).

##6 Discussion
###6.1 Towards a mechanistic understanding of gas exchange in large rivers
Field studies of gas exchange in wide rivers have suggested that their *k* properties behave differently than in steeper and smaller rivers [@ulsethDistinctAirWater2019a; @beaulieuControlsGasTransfer2012a; @alinPhysicalControlsCarbon2011; @wangPhysicallyBasedScaling2021]. In sections 2 and 3 we have shown that this must be the case given the algebraic structure of the TKE budget in open-channel flows [@nakagawaTurbulenceOpenChannel1993] and the assumptions underlying turbulent scaling with interfacial fluxes [@katulStructureFunctionModel2018; @lorkeUnifiedScalingRelation2006]. This result profoundly amends how we scale *k* in large rivers and directly addresses a long-standing problem of upscaling fluvial *k*: that our current methods perform poorer in larger rivers than small ones.

We also statistically recovered the 1/4 scaling exponent in the classic $k \sim \epsilon^{1/4}$ model (Figure 3c) for gas exchange that has been repeadely validated in non-fluvial aquatic systems. This again suggests that *k* in large rivers behaves more similarly to lakes, esturaries, and the ocean than to steeper rivers where bubble-mediated gas exchange might occur [@ulsethDistinctAirWater2019a]. We also suggest that the TKE budget in smaller rivers and streams is additionally complicated by diffusive transport of TKE from the bed to the free surface, but this TKE production mechanism is functionally zero if the 'large river' condition is met (Figure 2). Channel bed roughness effects riverine gas exchange mostly in high energy streams where slope is sufficiently steep for bubble-induced gas exchange to occur [@hallGasExchangeStreams2020]. @ulsethDistinctAirWater2019a showed bed roughness loosely correlates with $k_{600}$ in steep Alpine streams. However, they coarsely estimated bed roughness from arial imagery, only studied extremely small mountain streams, and to date most similar work has focused on labratory exercises [e.g. @chansonStreamReaerationNonuniform; @moogStreamReaerationNonuniform1999]. In this study, we confirm that bed roughness is exerting functionally no influence on free-surface TKE in large rivers (Section 2 and figure 2) and therefore *k*. We show that free-surface TKE must be entirely produced and dissipated by form-drag and not bottom friction or roughness. However, this is only true in the largest of rivers. It is likely that the steeper slope parameter in Figure 3d and row six, Table 1 is due to the influence of bottom roughness on free-surface TKE in smaller streams.

###6.2 Towards remote sensing of global spatiotemporal dynamics of *k* in large rivers
To date, most field-scale studies of riverine gas exchange have focused on 1) its relationship with wind speed [e.g @beaulieuControlsGasTransfer2012a; @borgesVariabilityGasTransfer2004; @zappaEnvironmentalTurbulentMixing2007], 2) average flow velocity [e.g. @alinPhysicalControlsCarbon2011; @beaulieuControlsGasTransfer2012a; @schelkerCO2EvasionSteep2016a], or 3) discharge [e.g. @wangPhysicallyBasedScaling2021; @robertsMultipleScalesTemporal2007; @uehlingerEcosystemMetabolismDisturbance1998]. However, the spatiotemporal dynamics of riverine gas exchange are still weakly constrained. A few studies have investigated these dynamics, but they have been limited to individual rivers and/or limited field seasons [@hallAirWaterOxygen2012; @sand-jensenCO2DynamicsDanish2012]. @wallinSpatiotemporalVariabilityGas2011 performed a preliminary analysis in northern Sweden relating cross-section specific temporal variability in gas exchange with channel slope, but they were limited to an average of only 8 measurements per river in a single watershed. This limited knowledge of large-scale *k* spatiotemporal dynamics is due both to a lack of process-level understanding [@hallGasExchangeStreams2020] but also a lack of measurements. Authors have argued that the key to explaining the large residual variation in upscaling models is to explore at-a-station temporal variability in *k* [@hallGasExchangeStreams2020].

Therefore, estimating *k* from SWOT data is an attractive option for exploring its spatiotemporal dynamics at fine temporal resolution and at the global-scale. SWOT will provide daily hydraulic measurements for a 3 month fast sampling period for calibration and validation and sampling thereafter between 1 and 7 days per 21 day repeat cycle [@biancamariaSWOTMissionIts2016]. BIKER's success in 1) infering $k_{600}$ using simulated SWOT data over a wide range of rivers (Figures 4 and 5) and 2) being robust to measurement errors internal to the SWOT data (Figure 3) bode well for BIKER's eventual implementation on real SWOT observations.  The results presented here suggest that daily estimation of riverine gas exchange globally could be possible once SWOT launches.

###6.3 Towards remotely sensing riverine carbon emissions using SWOT
Figure 6 confirms that BIKER is quite successful, without any in situ information aside from a $CO_2$ logger, at predicting 1) $FCO_2$ (Figure 6a) and 2) the bulk carbon efflux (Figure 6b). This encouraging result has two main implications for future work coupling remote sensing via SWOT with in situ data. First, it confirms that we can couple BIKER and SWOT with in situ gas concentration loggers to produce $FCO_2$ estimates at novel temporal resolution in SWOT-observable rivers. This is particualry useful given recent advances in high temporal resolution in situ gas concentration measurements [@ahoHighestRatesGross2021] but no such similar advances in modeling *k* at high temporal resolutions. BIKER can likely also be ran at the field scale using arrays of pressure transducers to estimate water surface slope (rather than using satellite-based altimeters like SWOT) following recent work doing the same using the @hagemannBAMBayesianAMHGManning2017a RSQ algorithm [@harlanDischargeEstimationDense].

Secondly, it is important to stress that unlike BIKER, the HG models in Figure 6b rely on an in situ streamgauge. This means that Figure 6b represents the best performance that those models could ever have; if ran using modeled discharge their accuracy would necessarily decrease. Thus, these results suggest that BIKER will be useful in two settings: 1) upscaling in ungauged rivers as hypothesized, but also in 2) potentially improving our carbon efflux understandings at gauged sites. Future work should systematically quantify prediction error from coupling global-scope HG models with modeled discharge, as is the default workflow used in fluvial $FCO_2$ upscaling studies [e.g. @lauerwaldSpatialPatternsCO22015; @horgbyUnexpectedLargeEvasion2019; @raymondGlobalCarbonDioxide2013a]. **I assume Shaoda's paper will still be in review and can't cite here but this is exactly what they do...**

Figure 6b also confirms that the training data used for HG models exerts a significant influence on upscaled carbon emissions from rivers. In Figure 6b there is a nearly 0.5 Tg-C range between estimates, which is significant and nearly entirely a function of the data used to fit these depth HG models. In this context, the 'Brinkerhoff 2019' model likely outperforms both 'Raymond models' because the training data is orders of magnitude larger and more geomorphically varied than those used in the 'Raymond' models (530,945 measurements versus 1,026 and 10837 measurements). Meanwhile, BIKER has no similar reliance on hydraulic parameters trained on different datasets and only assumes that *dA* can be calculated by assuming a rectangular river channel. Upon SWOT's launch, the BIKER approach to estimating *k* could be coupled with ethier existing upscaling workflows or even explicit $CO_2$ transport models [@brinkerhoffLakeMorphometryRiver2021; **Saccardi & Winnick in review**] to improve riverine gas flux predictions where gauges are unavailable but SWOT measurements are. This coupling could potentially be done using data assimilation techniques, which have proven very useful for similar objectives in recent RSQ work [@ishitsukaCombiningOpticalRemote2020].

##7 Conclusions


##8 Acknowledgements
C.B. Brinkerhoff was funded on **FINESST babyyyy**. BIKER is available at https://github.com/craigbrinkerhoff/BIKER. All code to build and generate results, figures, and the manuscript is available at https://github.com/craigbrinkerhoff/RSK600. Data used in this study was generously made available by the authors of @frassonExploringFactorsControlling2021, @durandIntercomparisonRemoteSensing2016b, @beaulieuControlsGasTransfer2012a, @ulsethDistinctAirWater2019a, and @raymondScalingGasTransfer2012a.

##9 Apendix A
*Table A1: Variable description and notation for this study. TKE refers to 'turbulent kinetic energy'*

|**Notation**|**Description**|**Calculation (if applicable)**|**Units**|
|------------|---------------|-------------------------------|---------|
|*Bulk carbon efflux*|carbon mass transport rate from river to atmosphere|NA|$[\frac{M}{T}]$|
|$C_{water}$|Water-side gas concentration|NA|$[L]$|
|$C_{air}$|Air-side gas concentration|NA|$[L]$|
|$\epsilon$|TKE dissipation rate|$\frac{U_*^3}{H}$|$[\frac{E}{M*T}]$|
|$\epsilon_D$|TKE dissipation rate via form-drag|$gSU$|$[\frac{E}{M*T}]$|
|$FCO_2$|$CO_2$ evasion flux from river to atmosphere|NA|$[\frac{M}{L^2T}]$|
|$g$|gravitational acceleration|9.8|$[\frac{L}{T^2}]$|
|$G$|TKE production rate|$\frac{UU_*}{H}$|$[\frac{E}{M*T}]$|
|$h$|Elevation above the bed|NA|$[L$|
|$H$|Mean flow depth|NA|$[L]$|
|$k$|gas exchange velocity|NA|$[\frac{L}{T}]$|
|$k_{600}$|gas exchange velocity normalized to Sc=600|NA|$[\frac{L}{T}]$|
|$R_h$|Hydraulic radius|$\frac{AW}{2H+W}$|$[L]$|
|$S$|River slope|NA|$[\frac{L}{L}]$|
|$Sc$|Schmidt number|NA|$unitless$|
|$T_d$|TKE turbulent diffusion rate|NA|$[\frac{E}{M*T}]$|
|$U$|Reach-averaged flow velocity|NA|$[\frac{L}{T}]$|
|$U_*$|Shear velocity|$\sqrt{gSR_h}$|$[\frac{L}{T}]$|
|$v$|kinematic viscosity|NA|$[\frac{L^2}{T}]$|
|$V_d$|TKE viscous diffusion rate|NA|$[\frac{E}{M*T}]$|
|$v_K$|turbulence characteristic velocity scale|NA|$[\frac{L}{T}]$|
|$W$|Flow width|NA|$[L]$|




## References