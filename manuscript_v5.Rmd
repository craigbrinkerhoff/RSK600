---
title: "Gas exchange in large rivers controlled by hydraulic geometry: implications for remotely sensing gas exchange via the SWOT satellite"
author: 'CB Brinkerhoff, CJ Gleason, CJ Zappa, PA Raymond, MH Harlan'
date: "`r Sys.Date()`"
bibliography: References.bib
csl: agu_citation_style.csl
output:
  word_document: 
      reference_docx: word-styles-reference.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Key Points
- River channel efficiency effec the relationship between gas exchange and form-drag dissipation of turbulence
- Large, less efficient channel geometry necessitates that near-surface turbulence is dominated by form-drag rather than bed friction
- BIKER algorithm exploits this theory, predicting gas exchange velocity and $CO_2$ fluxes from simulated SWOT satellite data and in situ $CO_2$ data

##Keywords
gas exchange, fluvial geomorphology, open-channel flow, remote sensing, SWOT, biogeochemistry, ungauged basin

##Abstract
*AGU Advances. So 250 words here* <br>
*AGU advances is 8000 words total, the format seems to be a long letter so I've tried to right this in that style. Might be a bold organization but we'll see*

##Plain Language Summary
*Necessary for AGU advances (200 words)*

##1 Introduction
Natural systems play a fundamental role in the budgeting and accounting of the global carbon cycle under climate change. Since the publication of @colePlumbingGlobalCarbon2007a, the global river network is recognized to emit substantial amounts of carbon to the atmosphere, in addition to exporting it to the oceans. Current estimates of total carbon dioxide evasion ($FCO_2$) to the atmosphere from the global river network vary from 650-1800 Tg C/yr [@lauerwaldSpatialPatternsCO22015; @raymondGlobalCarbonDioxide2013a] **maybe add Shaoda here**, with 167 Tg-C/yr coming from mountain streams alone [@horgbyUnexpectedLargeEvasion2019]. Despite its incredibly small percentage of the global land surface [0.47%- @raymondGlobalCarbonDioxide2013a], this flux is on par with the total oceanic $CO_2$ uptake rate [@gruberOceanicSinkAnthropogenic2019; @horgbyUnexpectedLargeEvasion2019] and the global forest carbon uptake rate [@panLargePersistentCarbon2011]. It is still relatively poorly constrained but is clearly a critical component of the global carbon cycle. Equation 1 represents this flux given the gas concentration gradient between the water $CO_{2_{water}}$ and the air $CO_{2_{air}}$ and the gas exchange velocity *k*. Consult Appendix A for variable nomenclature used in this study.

$$\mathbf{(1)} FCO_2=k(CO_{2_{water}}-CO_{2_{air}})$$

The structure of equation 1 necessitates that calculations of this flux are highly sensitive to one's measurements/estimates of *k* [@hallGasExchangeStreams2020]. Even more broadly, fluvial *k* for various dissolved gases are of significant importance to aquatic ecologists modeling stream metabolism [e.g. @bernhardtMetabolicRegimesFlowing2018] and water quality engineers modeling river responses to pollutant loadings [among other things- @chapraSurfaceWaterQualityModeling2008]. Decades of work have focused on elucidating the physical mechanisms behind *k* in oceans and lakes [@wanninkhofAdvancesQuantifyingAirSea2009] and, to a lesser extent, fluvial gas exchange [@hallGasExchangeStreams2020]. Given that *k* should scale with near-surface turbulence in a turbulent flow [@hallGasExchangeStreams2020], extensive field and labratory experiments have converged on the 'small-eddy model' as proposed by @lamontEddyCellModel1970, which scales *k* via the smallest-scale turbulent eddies [e.g. @zappaEnvironmentalTurbulentMixing2007; @lorkeUnifiedScalingRelation2006; @zappaVariationSurfaceTurbulence2003; @moogStreamReaerationNonuniform1999; @wangCoefficientsSmallEddy2015; @vachonRelationshipNearsurfaceTurbulence2010]. This model is provided as equation 2, where $\epsilon_S$ is the dissipation rate of near-surface turbulence and $v$ is the kinematic viscosity and *Sc* is the Schmidt number.
$$\mathbf{(2)} k\sim Sc^{-n}(v\epsilon_S)^{1/4}$$

While this model works reasonably well in non-fluvial environments where turbulence production is largely confined to bottom shear or wind shear [e.g. @lorkeUnifiedScalingRelation2006; @zappaEnvironmentalTurbulentMixing2007], there is considerable uncertainity in how it applies to fluvial systems. First, 'bubble-mediated gas exchange' in whitewater might lead to substantially higher *k* in small mountain streams with very large bedload [@hallAirWaterOxygen2012; @ulsethDistinctAirWater2019a]. Additionally, 'form-drag shear' via river channel banks, meanders, bars, etc. further complicate scaling fluvial *k* [@moogStreamReaerationNonuniform1999]. Those authors proposed modeling fluvial *k* via 'form-drag dissipation' $\epsilon_D$, assuming that total reach stream power is responsible for all turbulence production and therefore dissipation. Numerous authors have since shown that this model ($\epsilon_D=gS\overline{U}$) reasonably predicts *k* in rivers [@raymondScalingGasTransfer2012a; @ulsethDistinctAirWater2019a; @moogStreamReaerationNonuniform1999], though it is not synonmous with equation 2 as $\epsilon_D$ refers to a depth-scale disispation rate and is not necessairily indicative of the near-surface dissipation rate. Likewise, $k\sim\epsilon_D$ usually has a slope much steeper than 1/4.

Relatively less attention has been paid to gas exchange in very large rivers, which is often conceptualized as a hybrid condition of both fluvial and non-fluvial hydraulic properties. To date, the handful of existing field studies of large-river *k* have suggested that *k* begins to be influenced by wind shear, though little else is well-established [@alinPhysicalControlsCarbon2011; @beaulieuControlsGasTransfer2012a; @wangPhysicallyBasedScaling2021]. These mechanistic uncertainties are additionally limited by a large dearth of field-measured fluvial *k*. @wangPhysicallyBasedScaling2021 attempted to address this by simulating *k* in 35 rivers using stream metabolism modeling [@applingOvercomingEquifinalityLeveraging2018] and in situ dissolved oxygen (DO) datasets, finding that equation 2 + $\epsilon$ modeled via the log-law-of-the-wall is valid in their simulated rivers and that *k*~streamflow relationships breakdown in large rivers. However, they did not directly compare against *k* data in extremely small systems [@ulsethDistinctAirWater2019a] and stopped short of parsing out hydraulic explanations for why this happens.

Further, these mechanistic uncertainties are then propogated through upscaling workflows when biogeochemists predict *k* across thousands of rivers [e.g @borgesGloballySignificantGreenhousegas2015a; @horgbyUnexpectedLargeEvasion2019; @lauerwaldSpatialPatternsCO22015; @raymondGlobalCarbonDioxide2013a] via equation 1 coupled with hydraulic geometry [HG: the scaling relationships between streamflow and river channel hydraulics- @leopoldHydraulicGeometryStream1953a]. It is currently not well understood how sensitive global estimates of fluvial gas evasion are to the specific HG model that is employed by the worker. Further, these approaches rely on either in situ discharge records or modeled streamflow which introduces additional uncertainities. This is all exacerbated in ungauged basins that cover large areas, especially in the carbon-rich Arctic inland waters, where little in situ information is available and fieldwork is impractical [@gleasonRemoteSensingRiver2020].

A potential alternative to this upscaling approach is to directly estimate a river's hydraulic properties from remote sensing (RS) data. Remote sensing of river hydraulics is a burgeoning subfield within remote sensing of hydrology, often in service of remote sensing of river discharge [RSQ- @gleasonRemoteSensingRiver2020]. This is accomplished via two general approaches: 'gauged' methods which rely on in situ river data to calibrate one's method to the river(s) at hand and 'ungauged' techniques which focus on hydraulic generalizability in the service of merely improving existing knowledge in data-poor domains [@gleasonRemoteSensingRiver2020]. Many, but not all, of these ungauged approaches are developed in the context of the upcoming NASA/CNES/UKSA/CSA Surface Water and Ocean Topography (SWOT) satellite mission. SWOT is expected to launch in 2022 and provide the world's first global measurements of water surface extent and elevation at novel temporal resolutions. SWOT is a wide swath radar interferometer and will sample rivers every 1 to 7 days per 21 day repeat cycle and will measure rivers wider than 100m with a goal of expanding this to rivers at least 50m wide [@biancamariaSWOTMissionIts2016]. A decade of SWOT work has explored the multi-parameter problem of estimating the river hydraulic parameters of roughness and bathymetry from remote sensing to produce the SWOT discharge product [e.g. @andreadisConstrainingAssimilationSWOT2020d; @brinkerhoffConstrainingRemoteRiver2020a; @durandEstimatingReachaveragedDischarge2014a; @garamboisInferenceEffectiveRiver2015; @gleasonRetrievalRiverDischarge2014a; @garamboisVariationalEstimationEffective2020; @brissetAssimilationAltimetricData2018; @hagemannBAMBayesianAMHGManning2017a; @larnierRiverDischargeBathymetry2020a; @oubanasDischargeEstimationUngauged2018].

In this context, here we revist the fundamental mechanisms behind gas exchange and turbulence in large rivers to answer the following question: does *k*'s relationship with form-drag fundamentally change in large rivers and how does this relate to one of the classical model's of gas evasion in aquatic systems (equation 2)? We exploit the findings from this simple analysis to develop a novel methodology that predicts $k_{600}$ (*k* normalized to a Schmidt number of 600) and its explicit uncertainity solely using SWOT observations. The method requires no in situ inputs of any kind (although in situ data can be ingested and will improve results). We name the RS of $k_{600}$ algorithm BIKER, or the 'Bayesian Inference/Inversion of the $k_{600}$ Evasion Rate' and validate it for 47 SWOT-observable rivers from around the world using hydraulic models to produce SWOT-like data (as SWOT has not yet launched). We also quantify BIKER's sensitivity to the expected SWOT measurement errors on 17 of those rivers: while SWOT data represent a sea change in inland water monitoring, it is expected to have an approximately 10cm error in water surface elevation [@biancamariaSWOTMissionIts2016] as well as river width errors [@frassonExploringFactorsControlling2021]. Finally, we use previously published dissolved $CO_2$ data to represent a hypothetical in situ $CO_2$ sensor and compare the bulk carbon efflux from the 47 rivers as calculated using BIKER and previously published in situ techniques for predicting $k_{600}$.

##2 Data
Numerous datasets were used in this study. Please see Figure 1 for a map of the approximate locations for the data used in this study. We also provide a flowchart detailing the entire study as Figure S1.

![Figure 1: Map of the 47 hydraulic models and 1 timeseries of CO2 samples used in this study. Note that hydraulic model locations are approximate as some of the models are not geo-referenced. Not mapped here are over 530,000 discrete measurements of river channel hydraulics from across the continetal United States (Brinkerhoff et al. 2019) and over 700 gas exchange velocity measurements (Ulseth et al. 2019).](cache/maps/map_fin.jpg)

Gas exchange theory (section 2) is explored using the dataset from @ulsethDistinctAirWater2019a who measured and/or collected from the literature over 700 measurements of stream hydraulics and $k_{600}$ and is, to our knowledge, the largest collection of field-measured river and stream $k_{600}$. To assess general hydraulic conditions in rivers across geographic contexts, we additionally use a previously published compilation of field hydraulics measurements that were originally made to calibrate United States Geological Survey (USGS) streamgauge rating curves [@brinkerhoffReconcilingAtaStationAtManyStations2019]. That dataset contains over 530,000 unique measurements of river channel velocity, width, depth, and discharge from across the continental United States. This is to our knowledge the largest collection of field measurements of river channel hydraulics. Ultimately, this dataset was filtered down to 171,553 discrete measurements (see Text S1 for our filtering protocol).

BIKER validation (section 4) was performed on 47 SWOT-simulated rivers. Because SWOT has yet to launch, it is standard practice to benchmark SWOT-related algorithms on "SWOT-like" data. These simulated rivers are simply river-reach-averaged hydraulic model outputs where the water surface heights and widths are labelled as RS observations and are used as the sole inputs to BIKER. Here, we use 47/51 rivers collected by @frassonExploringFactorsControlling2021 and @durandIntercomparisonRemoteSensing2016b. These are the two benchmarking studies that have explored RSQ algorithm performance for the SWOT mission. The approximate locations of these rivers are plotted in Figure 1, and please consult both of those papers for all of the hydraulic model specifications. Ultimately, the 47 rivers are spread across the United States, France, Italy, the United Kingdom, and Bangladesh. We omit three models from @durandIntercomparisonRemoteSensing2016b because they lack enough hydraulic information to calculate the shear velocity $U_\star$, which is necessary for algorithm validation (see Appendix A for all variable descriptions and notation used in this study). These are two models for the Saint Lawrence River and one for the Tanana River.

To assess the influence of measurement error on BIKER's performance (section 4), we use the error model developed by @durandHowWillRadar2020a and implemented on 17/47 of the rivers by @frassonExploringFactorsControlling2021. Error in SWOT measurements will come from both the error tolerances intrinsic in the satellite data product as well as radar layover error. Layover error is the phenomenon when radar returns from different places arrive at the sensor at the same time, leading to taller landscape features appearing closer to the sensor than shorter landscape features that are the same horizontal distance from the sensor [@durandHowWillRadar2020a]. Width errors due to poor water classification are ignored as they were in @frassonExploringFactorsControlling2021.

For the $CO_2$ evasion and carbon efflux calculations (section 4), we use 26 bi-weekly dissolved $CO_2$ samples made by @beaulieuControlsGasTransfer2012a at one location in the Ohio River for one calender year from 2008-2009 (Figure S2). Note that this $CO_2$ data is for the Ohio River only but was applied to all 47 rivers (which includes multiple sections of the Ohio River). Because we are exclusively interested in the relative differences between $FCO_2$ estimates and not the raw fluxes themselves, any $CO_2$ data representative of SWOT-observable rivers was deemed acceptable.

##3 Form-drag in large rivers and implications for scaling fluvial gas exchange velocity
Turbulence is fundamental to fluvial geomorphology and open-channel flows and has been the subject of extensive research across scientific and engineering disciplines for over a century. Turbulence in river flows is usually generated by shear forces within the river channel (wind shear's influence is usually limited to only the absolute widest rivers). This within-bank shear comes from the riverbed, as well as 'form-drag' via riverbanks, meanders, bars, suspended sediment, etc. Both @raymondScalingGasTransfer2012a and @moogStreamReaerationNonuniform1999 confirmed that $\epsilon_D$ is far greater than $\epsilon_S$ in open-channel flows, therefore generating the majority of fluvial TKE dissipation.

'Form-drag' shear exists at the depth-scale and therefore is scale-dependent: while small roughness elements near the bed produce form-drag, if they are small relative to the total flow depth they will exert little influence on near-surface dissipation [@moogStreamReaerationNonuniform1999]. This means that, if all other properties of a river flow are held constant but the channel is progressively made wider and shallower, the depth-scale will decrease and form-drag will compose a progressively larger component of near surface dissipation. This concept is illustrated graphically in Figure 2 and represents the geomorphic concept of 'river channel efficiency': all else being constant, a less efficient channel (wide/shallow) will have a longer wetted perimeter and therefore a larger shear surface area than the same flow through a narrow/deep channel [@chowOpenChannelHydraulics1959a]. This means that the inefficient channel will 1) exhibit more form-drag and thus turbulence, and 2) turbulence generated via form-drag will more readily reach the surface. Note that to compare wetted perimeters across many rivers with different channel areas, we use the hydraulic radius $R_h$ (channel area divided by the wetted perimeter) as compared to the mean flow depth $H$. An efficient channel will have a low $\frac{R_h}{H}$ ratio while an inefficient channel will have a high $\frac{R_h}{H}$ ratio that approaches 1.

![Figure 2: Conceptual model relating river channel efficiency to the turbulent dissipation rate. All else being constant, a less efficient channel shape (wide/shallow) will 1) have more form-drag and thus turbulence and 2) turbulence generated via form-drag will more readily reach the surface.](cache/k600_theory/conceptual_model.jpg)

This all suggests that, for incredibly inefficient river channels, $\epsilon_S \approx \epsilon_D$. Put another way, the channel produces so much turbulence from form-drag, and the flow is so shallow relative to its width, that depth-scale dissipation is likely synonmous with near-surface dissipation. This would mean that equation 2 could be equivalently written as $k\sim Sc^{-n}(v\epsilon_D)^{1/4}$ when a channel is sufficiently inefficient. To explore when, if at all, this point is reached we fit models using 701 river $k_{600}$ measurements from @ulsethDistinctAirWater2019a. We defined 'channel inefficiency' using minimum $\frac{R_h}{H}$ thresholds from 0.75 to 0.995 and then we fit the two models outlined in equations 3 and 4. Because all of the data are normalized to Schmidt numbers of 600, we can convienantly fold the viscosity and Schmidt numbers into the model coefficients. The goal of this analysis is to find at what $\frac{R_h}{H}$ threshold does 1) equation 3's b parameter approximate 1/4 and 2) equation 4's goodness-of-fit (via the coefficient of determination $r^2$) reach a suitably high value.
$$\mathbf{(3)} k_{600}=a(\epsilon_D)^{b}$$
$$\mathbf{(4)} k_{600}=\beta(\epsilon_S)^{1/4}$$

The results of this analysis are plotted in Figure 3a, along with channel geometry schematics to highlight the progressive shift from efficient to inefficient river channels. Equation 3's b parameter only begins to approximate 1/4 when $R_h$ is within 1% of the mean flow depth. At this point, the model's goodness-of-fit also reaches a reasonable value of 0.68. This indicates that a river is sufficiently inefficient when its hyradulic radius approximates the mean flow depth, and at that point $\epsilon_S \approx \epsilon_D$. Figures 3b-4d plot the model fits for this final scenario where $\frac{R_h}{H} >= 0.995$ As Figure 3c confirms, the small-eddy model is viable when a channel is so inefficient that dissipation via form-drag approximates the near-surface dissipation rate in equation 2. Figure 4d further confirms this, where the slope of the generalized model (equation 3) equals `r round(models_ulseth[models_ulseth$name == 'Rh=H',]$slope, 2)` which is nearly equivalent to 1/4.

![Figure 3: Model development for predicitng k from form-drag dissipation in rivers. (a) Rh/H thresholds versus fitted model results. Dark blue is the fitted b parameter in equation 3 and dark green is the goodness-of-fit of equation 4 as defined by the coefficient of determination. Once a channel is maximally inefficient, i.e. Rh=H, equation 4 is a viable model for k and equation 3 empirically recovers the theoretical value of 1/4 as outlined in equation 2. (b-d) Fitted model results for inefficient channels (defined as Rh/H >= 0.995) predicting k via the shear velocity U*, equation 4, and equation 3 (respectively). Note that colors align to the same models for subpanels a, c, and d. Further note that the coefficient of determination in subpanel (d) refers to log-transformed residuals and hence is not directly comparable to those in subpanels (b) and (c).](cache/k600_theory/k600Plot.jpg)

Finally, becuase $\epsilon_D$ refers to a depth-scale quantity, we tested whether a more parsimonious model is possible by removing the 'middle-man', i.e. the Kolmogorov velocity scale, and directly predicting *k* from depth-scale turbulence. Figure 3b plots fitted model results for the $k=\beta_1U_*$ model. For this data, $U_*$ explains 70% of variation in $k_{600}$ and, as expected, the fitted model is nearly identical to Figure 4c in scaling dynamics (as confirmed visually and via the goodness-of-fit). This all indicates that depth-scale turbulent production/dissipation dominates the surface dissipation signal in maximally inefficient river channels. These findings build off of @ulsethDistinctAirWater2019a's intial result that channel slope exerts a drammatic influence on *k* scaling dynamics, further suggesting that fluvial *k* is as much a function of hydraulic geometry as the turbulence properties of the flow.

With all of that said, how often is a river channel so inefficient that $R_h \approx H$? To answer this question, we join the 701 measurements from @ulsethDistinctAirWater2019a to 171,553 discrete river hydraulics measurements from across the continetal United States [@brinkerhoffReconcilingAtaStationAtManyStations2019]. We find that `r round(percs_overall[percs_overall$flag_depth == 'Rh=H',]$perc,0)`% of hydraulic radii are within 5% of their mean flow depth. Because these measurements were made exclusively at streamgauges where rivers are somewhat channelized and width variability is decreased, we opted for a slightly more liberal ratio of 5%. Because larger rivers are more likely to have inefficient channels, we then flag the measurements that are SWOT-observable, i.e. width > 100m. We find that while `r round(percs[percs$flag_depth == 'Rh=H',]$perc,0)[1]`% of non-SWOT observable rivers meet this inefficient condition, `r round(percs[percs$flag_depth == 'Rh=H',]$perc,0)[2]`% of SWOT-observable rivers do. This significant difference, and near universality of SWOT-observable rivers being inefficient, suggests that our theoretical findings in Figure 3 should hold in nearly all rivers that SWOT will observe. This opens the door for exploiting our 'inefficient river k model' for remote sensing *k* via the SWOT satellite. 

##4 Exploiting the 'inefficient river model' to remotely sense gas exchange velocity via the BIKER algorithm
We have shown that scaling $k_{600}$ via the depth-scale shear-velocity ($U_*$) explains ~70% of the variation in $k_{600}$ in inefficient rivers and that nearly all SWOT-observable rivers are inefficient. Further, because of the structure of $U_*$ (Appendix A) we can easily reduce the 'inefficient river' $k_{600}$ model (Figure 3b) to an equation consisting solely of remotely-sensible river hydraulics and an intial estimate of the channel area. By scaling *k* this way, we significantly reduce potential equifinality issues by having just two unknowns: $k_{600}$ and the median channel area $A_0$. Equifinality refers to an under-constrained mathematical system that has essentially infinite parameter combinations that can produce the same result: there are in essence more unknowns than equations [@garamboisInferenceEffectiveRiver2015]. This problem is experienced by both SWOT RSQ algorithms and in situ tools that concurrently solve for *k* and stream metabolism [@applingOvercomingEquifinalityLeveraging2018; @graceFastProcessingDiel2015; @holtgrieveSimultaneousQuantificationAquatic2010]. In both of these domains, the other unknown parameters are often difficult to estimate (bed roughness and stream metabolism, respectively) while for BIKER, median channel area is relatively easy to approximate from the SWOT-observable river width [@brinkerhoffConstrainingRemoteRiver2020a]. Therefore, we develop the BIKER algorithm, which is informed by the @hagemannBAMBayesianAMHGManning2017a algorithm for ungauged RSQ and further explored in more recent work by @brinkerhoffConstrainingRemoteRiver2020a. These papers conceptualize discharge as a Bayesian remote sensing problem, which we largely follow here to conceptualize $k_{600}$ as a Bayesian remote sensing problem that can be solved using SWOT data.

BIKER, and Bayesian inference in general, starts from Bayes rule (equation 5), where $\Theta$ is some set of non-remotely-sensible parameters we want to solve for (including $k_{600}$), *x* is the observed data, $f(x|\Theta)$ is the 'likelihood function' or sampling model conditional on the parameters, and $p(\Theta)$ is the joint prior distribution of the parameters. Therefore, we are interested in solving for $p(\Theta|x)$, or the 'posterior' distribution. For BIKER, *x* is the SWOT-observables: river width *W* and water surface elevation *H* (which is used to calculate the water surface slope $S_h$). Note that $p(x)$ is usually computationally intractable to integrate, so Bayesian inference tools require only the proportionality to be specified: $p(\Theta|x) \propto f(x|\Theta)p(x)$. Sampling algorithms are then used to approximate the posterior distribution, as is done in BIKER.

$$\mathbf{(5)} p(\Theta|x) = \frac{f(x|\Theta)p(\Theta)}{p(x)}$$

The heart of BIKER is its reformulation of the $k_{600}$ model as a Bayesian sampling model that is conditional only on the data that SWOT will provide. To do this, $k_{600}$ is first written as a function of SWOT-observables *W* and $S_h$. This algebra is carried out using the model parameter from Figure 3b (56.0294) and yields equation 6, where we follow our earlier assumption that $R_h = H =\frac{A}{W}$ where *A* is wetted channel area. *A* is further split into the SWOT-observable portion *dA* and the unobservable portion $A_0$ following @durandEstimatingReachaveragedDischarge2014a. *dA* is estimated assuming a rectangular river channel (usually valid when $R_h=H$) so that $dA \approx \delta H*W$. Thus, there are no reliances on bed roughness, flow velocity, or any other terms that are difficult to infer from river width.

$$\mathbf{(6)} \begin{eqnarray} k_{600} = \bigg(56.0294 S_h(\frac{A_0+dA}{W})\bigg)^{1/2} \end{eqnarray}$$

Next, equation 6 is written as a Bayesian sampling model, in which all of the SWOT observations are sampled from the unknown model parameters ($A_0$ and $k_{600}$). This is equation 7 after log-transforming all of the variables. The $\sigma_{k_{600}}^2$ parameter refers to the uncertainty inherent in equation 6's estimates. Equation 7 also necessitate that we specify prior distributions for the parameters $A_0$ and $k_{600}$. Prior distributions, defined by their hyperparameters, formalize the a priori estimates (and uncertainties) for the non-remotely-sensed terms. More intuitively, BIKER priors represent our 'prior river knowledge' of what $A_0$ and $k_{600}$ probably are for some river since they cannot be remotely sensed. Hyperparameter specifications are detailed in Text S2, however the goal was to rely on absolutely no in situ information such that we could run this method on any river on Earth solely using SWOT observations.

$$\mathbf{(7)} \left[log(56.0294) + \frac{1}{2}log(g) + \frac{1}{2}log(S_h) - \frac{1}{2}log(W)\right] \sim normal\left(\left[log(k_{600})-\frac{1}{2}log(A_0+dA)\right], \sigma^2_{k_{600}}\right)$$

With the sampling model (equation 7) and hyperparameters described (Text S2), a joint posterior distribution conditional on the SWOT observations is specified. To approximate this distribution, we use a Markov Chain Monte Carlo (MCMC) algorithm implemented using the Stan probabilistic programming language. Specifically, Stan uses a Hamiltonian Monte Carlo sampler which reduces computation time relative to other sampling algorithms [@hagemannBAMBayesianAMHGManning2017a].

We validate BIKER on 47 SWOT-simulated rivers using daily observed $R_h$ and observed $S_h$. We also re-validate BIKER on the 17 rivers with the SWOT error model corrupting the SWOT-observables *W* and *H* (this workflow and the metrics used are detailed in Text S3 and Table S1). Regardless of the validation setup, we do not have observed $k_{600}$ data for these rivers, and to our knowledge no field dataset of $k_{600}$ exists in the type of temporal and spatial frequency that SWOT (and therefore the BIKER algorithm) provides. Therefore, we take the model outlined in Figure 3b and use that to calculate the observed $k_{600}$ that BIKER is validated against. With this setup, we are directly exploring BIKER's ability to infer observed $A_0$ and $k_{600}$ from *W* and *H* alone, as the *k* scaling model has already been sucessfully validated (Figure 3).

Figure 4a plots the validation results for $k_{600}$ (with no SWOT measurement error) across all  rivers and all timesteps. The points are the posterior means while the black lines are the 95% confidence intervals (CIs) for the predictions. $k_{600}$ is strongly correlated with the BIKER-predicted $k_{600}$ ($r^2$ of `r round(results_3_2_all$r2, 2)`). Using absolutely no in situ information, BIKER captures the magnitude of the predictions and most points fall on or near the 1:1 line. The regression of the estimates (solid grey line) nearly recovers the 1:1 line (dashed black), but there is an over/underestimation bias in the largest/smallest $k_{600}$ values. The RMSE for the BIKER predictions is `r round(results_3_2_all$rmse,2)` m/day) across all observations.

![Figure 4. a: Validation of BIKER for 47 SWOT rivers. Black bars are 95% CIs for the modeled values. Grey line is linear regression (and 95% prediction intervals are dashed) and dashed black line is 1:1 line. b-d: validation timeseries for three rivers representative of good, reasonable, and poor BIKER performance. b) was randomly selected from the upper tertile of NRMSE scores, c) was randomly selected from the middle tertile, and d) from the worst tertile. See Figure S3 for all other rivers. Model results include the posterior means and 95%.](cache/validation/validation.jpg)

Figure 4b-d are representative timeseries plots of predicted and observed $k_{600}$ for three rivers chosen randomly from those with 'good' NRMSE scores (b), 'okay' NRMSE scores (c), and 'bad' NRMSE scores (d). See Table S1 for the definition of NRMSE, the Figure 4 caption for how this was determined, and Figure S3 for the other river timeseries plots. For the Missouri Midsection River, the entire timeseries of $k_{600}$ is nearly perfectly predicted, while in the Seine River the dynamics (peaks and valleys) are reasonably captured but they are magnified to be far larger than the observed dynamics. Generally, though, mean $k_{600}$ is reasonably recovered for the Seine, as confirmed visually. In the Fresno River, there is significant positive bias in the estimates but also massive uncertainty (per the 95% CIs) in those estimates, indicating that BIKER is highly uncertain about its output (and rightfully so). Correct temporal dynamics are also largely missing from BIKER's Fresno River predicitions.

Figure 5a plots validation metrics calculated for each river with and without SWOT measurement error (green and purple, respectively). The points making up these boxplots (47 and 17, respectively) are overlain atop the boxplots. See Table S1 for metric definitions. SWOT measurement errors neglibly influence BIKER's performance across all four error metrics (Figure 5a), though caution should be used in over-interepting boxplots with a sample size of only 17. Given Figure 5a, we deem that SWOT measurement error does not exert a significant influence on BIKER and so the results presented for the rest of the manuscript assume no measurement error in order to use all 47 rivers.

![Figure 5. a: Performance metrics by river. See Table S1 for metric definitions. b: NRMSE scores (per river) versus the number of SWOT observations used in the Bayesian inversion. As expected, performance improves substantially with large amounts of data and degrades significantly with small amounts of data. Dashed lines denote scores of 0, 0.50, and 1. CIs.](cache/validation/validation_by_river.jpg)

Median river-specific $r^2$ is `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$r2, na.rm=T),2)`, which is excellent given that absolutely no in situ information is being used to predict $k_{600}$. NRMSE and RRMSE have median scores of `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$nrmse, na.rm=T),2)` and `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rrmse, na.rm=T),2)`, respectively, which are again good for a completely ungauged method. These are comparable to the best NRMSE scores achieved by the SWOT RSQ algorithms [@frassonExploringFactorsControlling2021]. Median rBIAS is `r round(median(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rBIAS, na.rm=T),2)`, highlighting a  positive bias in most rivers' predictions. This further supports the visual evidence in Figure 4 that sometimes BIKER is overestimating the magnitude of $k_{600}$ and that this might be river-specific. While median $r^2$ and rBIAS scores were strong, the ranges of these scores were somewhat large (standard deviation for $r^2$ of `r round(sd(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$r2, na.rm=T),2)` and for rBIAS of `r round(sd(results_3_2_rivs[results_3_2_rivs$errFlag == 0,]$rBIAS, na.rm=T),2)`).

Figure 5b highlights one benefit of using Bayesian inference to estimate $k_{600}$: because the posterior is conditional on the SWOT observations, performance should improve with more data. Figure 5b plots by-river NRMSE scores versus the number of SWOT observations. While performance varies considerably when observations are up to ~400, the three rivers with nearly 600 observations universally show excellent BIKER performance, and the worst BIKER performance is universally in rivers with only 12 observations.

##5 Remotely sensing carbon emissions from rivers
It is one thing to accurately predict *k*, but researchers are often most interested in the actual gas fluxes from rivers and ultimately the carbon emitted from river to atmosphere. Therefore, we also explore 1) BIKER's ability to reproduce $FCO_2$ $[M/L^2T]$ (equation 1) from these 47 rivers, and 2) a comparison of the representative carbon efflux $[M/T]$ from BIKER with established in situ methods. The details of this workflow are in Text S4, but broadly we pair the 26 biweekly $CO_2$ and water temperature samples (section 2, figure S2) from @beaulieuControlsGasTransfer2012a with a subset of SWOT observations (as the data are not daily). We then calculate $FCO_2$ using equation 1 and assuming atmospheric $CO_{2_{air}}$ is 390 uatm. Finally, we estimate a median bulk carbon efflux using BIKER's posterior means and three other in situ models for average channel depth (used to calculate $U_\star$) used for upscaling: one trained on the @brinkerhoffReconcilingAtaStationAtManyStations2019 dataset, and two previously published models [@raymondGlobalCarbonDioxide2013a; @raymondScalingGasTransfer2012a]. See Table S2 for their definitions. This allows us to assess whether BIKER's estimates (wholly ungauged) are comparable to gauged methods (all four HG models).

In Figure 6a, there is a very strong fit to the observed $FCO_2$ data, with an RMSE of `r round(results_3_3_all$rmse,2)` $g/m^2dy$. The performance is notably better than for $k_{600}$ alone (Figure 4a) and there is no systematic bias in the predictions across all 47 rivers. This is presumably due to the structure of the $FCO_2$ equation, which reduces the relative importance of errors in *k* given that the $CO_2$ data is measured in situ. $FCO_2$ prediction intervals are slightly narrower than those presented in Figure 4a as well.

![Figure 6: a: FCO2 via BIKER versus via equations 2 and 3 for every 11th timestep for the 49 rivers (grey lines are linear regression and 95% prediction intervals, while black dashed line is the 1:1 line). b-d: timeseries plots for the three example rivers from Figure 3b, 3c, and 3d.](cache/FCO2/FCO2_models.jpg)

Figure 6b compares the bulk carbon efflux (via $F_{CO_2}$) from the 47 rivers using BIKER posterior means and four streamgauge-based HG models. The results are largely equivalent for both the mean and median carbon efflux. Both the BIKER estimate (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_BIKER',]$sumFCO2, 2)` gG-C/yr) and the 'Raymond 2013' estimate (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_raymond2013',]$sumFCO2, 2)`) are somewhat overestimated relative to the observed flux (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_obs',]$sumFCO2, 2)`). The 'Brinkerhoff 2019' model nearly perfectly recovers the observed value (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_brinkerhoff2019',]$sumFCO2, 2)`).  Finally, the 'Raymond 2012' model slightly underestimates this bulk efflux (`r round(results_3_3_bulk[results_3_3_bulk$key == 'FCO2_raymond2012',]$sumFCO2, 2)`). Thus, despite BIKER using absolutely no streamgauge or other in situ data like the other 3 methods do, it provides a reasonable estimate of the carbon efflux (Figure 6b).

##6 Discussion
###6.1 Towards a mechanistic understanding of gas exchange in large rivers
Field studies of gas exchange in wide rivers have suggested that their *k* properties behave differently than in steeper and smaller rivers [@ulsethDistinctAirWater2019a; @beaulieuControlsGasTransfer2012a; @alinPhysicalControlsCarbon2011; @wangPhysicallyBasedScaling2021]. In sections 2 and 3 we have shown that this must be the case given the algebraic structure of the TKE budget in open-channel flows [@nakagawaTurbulenceOpenChannel1993] and the assumptions underlying turbulent scaling with interfacial fluxes [@katulStructureFunctionModel2018; @lorkeUnifiedScalingRelation2006]. This result significantly amends how we can scale *k* in large rivers and directly addresses a long-standing problem of upscaling fluvial *k*: that our current methods perform poorer in larger rivers than small ones.

We also statistically recovered the 1/4 scaling exponent in the classic $k \sim \epsilon^{1/4}$ model (Figure 3d) for gas exchange that has been repeadely validated in non-fluvial aquatic systems. This again suggests that *k* in large rivers behaves more similarly to lakes, esturaries, and the ocean than to steeper rivers. We also suggest that the TKE budget in smaller rivers and streams is additionally complicated by diffusive transport of TKE from the bed to the free surface, and that $T_d$ in equation 3 might explain why fluvial $k_{600}$ does not scale to the 1/4 power in smaller rivers. The presence of an appreciable $T_d$ term also increases the influence of channel bed roughness. @ulsethDistinctAirWater2019a showed bed roughness loosely correlates with $k_{600}$ in steep Alpine streams. However, they coarsely estimated bed roughness from arial imagery, only studied extremely small mountain streams, and to date most similar work has focused on labratory exercises [e.g. @chansonStreamReaerationNonuniform; @moogStreamReaerationNonuniform1999]. In this study and under the 'large river' condition, we confirm that bed roughness is exerting functionally no influence on free-surface TKE (Section 2 and figure 2) and therefore *k*. We show that free-surface TKE must be entirely produced and dissipated by form-drag and not bottom friction or roughness. However, this is only true in the largest of rivers.

###6.2 Towards remote sensing of global spatiotemporal dynamics of *k* in large rivers
To date, most field-scale studies of riverine gas exchange have focused on 1) its relationship with wind speed [e.g @beaulieuControlsGasTransfer2012a; @borgesVariabilityGasTransfer2004; @zappaEnvironmentalTurbulentMixing2007], 2) average flow velocity [e.g. @alinPhysicalControlsCarbon2011; @beaulieuControlsGasTransfer2012a; @schelkerCO2EvasionSteep2016a], or 3) discharge [e.g. @wangPhysicallyBasedScaling2021; @robertsMultipleScalesTemporal2007; @uehlingerEcosystemMetabolismDisturbance1998]. However, the spatiotemporal dynamics of riverine gas exchange are still weakly constrained. A few studies have investigated these dynamics, but they have been limited to individual rivers and/or limited field seasons [@hallAirWaterOxygen2012; @sand-jensenCO2DynamicsDanish2012]. @wallinSpatiotemporalVariabilityGas2011 performed a preliminary analysis in northern Sweden relating cross-section specific temporal variability in gas exchange with channel slope, but they were limited to an average of only 8 measurements per river in a single watershed. This limited knowledge of large-scale *k* spatiotemporal dynamics is due both to a lack of process-level understanding [@hallGasExchangeStreams2020] but also a lack of measurements.

Therefore, estimating *k* from SWOT data is an attractive option for exploring its spatiotemporal dynamics at fine temporal resolution and at the global-scale. SWOT will provide daily hydraulic measurements for a 3 month fast sampling period for calibration and validation and sampling thereafter between 1 and 7 days per 21 day repeat cycle [@biancamariaSWOTMissionIts2016]. BIKER's success in 1) infering $k_{600}$ using simulated SWOT data over a wide range of rivers (Figures 4 and 5) and 2) being robust to measurement errors internal to the SWOT data (Figure 5) bode well for BIKER's eventual implementation on real SWOT observations. Further, BIKER's improved performance with longer datasets (Figure 5b) bodes well for future SWOT implementation, as the three-year campaign will provide well north of 600 observations for many rivers, suggesting even better BIKER inversions than those presented here. All of this suggests that daily estimation of riverine gas exchange globally could be possible once SWOT launches.

###6.3 Towards remotely sensing riverine carbon emissions using SWOT
Figure 6 confirms that BIKER is quite successful, without any in situ information aside from a $CO_2$ logger, at predicting both $FCO_2$ (Figure 6a) and 2) the bulk carbon efflux (Figure 6b). This encouraging result has two main implications for future work coupling remote sensing via SWOT with in situ data. First, it confirms that we can couple BIKER and SWOT with in situ gas concentration loggers to produce $FCO_2$ estimates at novel temporal resolutions in SWOT-observable rivers. This is particualry useful given recent advances in in situ gas concentration loggers [@ahoHighestRatesGross2021] but no such similar advances in modeling *k* at equivalent temporal resolutions. BIKER can likely also be ran at the field scale using arrays of pressure transducers to estimate water surface slope (rather than using satellite-based altimeters like SWOT) following recent work doing the same using the @hagemannBAMBayesianAMHGManning2017a RSQ algorithm [@harlanDischargeEstimationDense].

Secondly, it is important to stress that unlike BIKER, the HG models in Figure 6b rely on an in situ streamgauge. This means that Figure 6b represents the best performance that those models could ever have; if ran using modeled discharge their accuracy would necessarily decrease. Thus, these results suggest that BIKER will be useful in two settings: 1) upscaling in ungauged rivers as hypothesized, but also in 2) potentially improving our carbon efflux understandings at gauged sites. Future work should systematically quantify prediction error from coupling global-scope HG models with modeled discharge, as is the default workflow used in fluvial $FCO_2$ upscaling studies [e.g. @lauerwaldSpatialPatternsCO22015; @horgbyUnexpectedLargeEvasion2019; @raymondGlobalCarbonDioxide2013a]. **I assume Shaoda's paper will still be in review and can't cite here but this is exactly what they do...**

Figure 6b also confirms that the training data used for HG models exerts a significant influence on upscaled carbon emissions from rivers. In Figure 6b there is a nearly 0.5 Tg-C range between estimates, which is significant and nearly entirely a function of the data used to fit these depth HG models. In this context, the 'Brinkerhoff 2019' model likely outperforms both 'Raymond models' because the training data is orders of magnitude larger and more geomorphically varied than those used in the 'Raymond' models (530,945 measurements versus 1,026 and 10837 measurements). Meanwhile, BIKER has no similar reliance on hydraulic parameters trained on different datasets and only assumes that *dA* can be calculated by assuming a rectangular river channel. Upon SWOT's launch, the BIKER approach to estimating *k* could be coupled with ethier existing upscaling workflows or even explicit $CO_2$ transport models [@brinkerhoffLakeMorphometryRiver2021; **Saccardi & Winnick in review**] to improve riverine gas flux predictions where gauges are unavailable but SWOT measurements are. This coupling could potentially be done using data assimilation techniques, which have proven very useful for similar objectives in recent RSQ work [@ishitsukaCombiningOpticalRemote2020].

##7 Conclusions
Gas exchange from aquatic systems has been studied for nearly a century, with a robust model (equation 2) that has been repeatedly verified across many non-fluvial environments. Despite renewed interest in fluvial gas exchange in the last decade or so, there are considerable uncertainties in how we model the gas exchange velocity in river environments and particularly in large rivers where wind increasingly influences *k*. Here, we show algebraically that TKE budgets in big rivers exist in a local equilbrium at the free surface and that we can equivalently scale *k* using any characteristic turbulence scale. We validate this using over 530,000 measurements of river channel hydraulics and over 700 discrete measurements of the normalized gas exchange velocity $k_{600}$. We then exploit this finding to remotely sense $k_{600}$ using simulated data that will be provided by the forthcoming SWOT satellite, showing good performance and relying on absoutely no on-the-ground information. Finally, we pair this algorithm (named 'BIKER') with an in situ $CO_2$ logger and show strong performance in reproducing $CO_2$ evasion fluxes and carbon efflux from the rivers' surfaces.

These strong results functionally open the door for global-scale, near daily estimates of fluvial gas exchange velocity once SWOT launches in 2022. This unprecedented amount of data should allow for significant insights into both the mechanistic and temporal dynamics of fluvial gas exchange in large rivers around the world. This, in turn, should allow us to better parameterize upscaling workflows such that the global fluvial carbon flux is better constrained.

##8 Acknowledgements
C.B. Brinkerhoff was funded on **FINESST babyyyy**. BIKER is available at https://github.com/craigbrinkerhoff/BIKER. All code to build and generate results, figures, and the manuscript is available at https://github.com/craigbrinkerhoff/RSK600. Data used in this study was generously made available by the authors of @frassonExploringFactorsControlling2021, @durandIntercomparisonRemoteSensing2016b, @beaulieuControlsGasTransfer2012a, @ulsethDistinctAirWater2019a, and @raymondScalingGasTransfer2012a.

##9 Apendix A
*Table A1: Variable description and notation for this study. TKE refers to 'turbulent kinetic energy'*

|**Notation**|**Description**|**Calculation (if applicable)**|**Units**|
|------------|---------------|-------------------------------|---------|
|*A*|Channel cross-sectional area|NA|$[L^2]$|
|*Bulk carbon efflux*|carbon mass transport rate from river to atmosphere|NA|$[\frac{M}{T}]$|
|$CO_{2_{water}}$|Water-side $CO_2$ concentration|NA|$[L]$|
|$CO_{2_{air}}$|Atmospheric-side $CO_2$ concentration|NA|$[L]$|
|$D_m$|Molecular diffusion coefficient|NA|$[\frac{L^2}{T}]$|
|$\epsilon$|TKE dissipation rate|$\frac{U_*^3}{H}$|$[\frac{E}{M*T}]$|
|$\epsilon_D$|TKE dissipation rate via form-drag|$gSU$|$[\frac{E}{M*T}]$|
|$FCO_2$|$CO_2$ evasion flux from river to atmosphere|NA|$[\frac{M}{L^2T}]$|
|$g$|gravitational acceleration|9.8|$[\frac{L}{T^2}]$|
|$G$|TKE production rate|$\frac{UU_*}{H}$|$[\frac{E}{M*T}]$|
|$h$|Elevation above the bed|NA|$[L]$|
|$H$|Mean flow depth|NA|$[L]$|
|$k$|gas exchange velocity|NA|$[\frac{L}{T}]$|
|$k_{600}$|gas exchange velocity normalized to Sc=600|$(\frac{600}{Sc_k})^{-0.5}k$|$[\frac{L}{T}]$|
|$R_h$|Hydraulic radius|$\frac{AW}{2H+W}$|$[L]$|
|$S$|River slope|NA|$[\frac{L}{L}]$|
|$Sc$|Schmidt number|$\frac{v}{D_m}$|$unitless$|
|$T_d$|TKE turbulent diffusion rate|NA|$[\frac{E}{M*T}]$|
|$U$|Reach-averaged flow velocity|NA|$[\frac{L}{T}]$|
|$U_*$|Shear velocity|$\sqrt{gSR_h}$|$[\frac{L}{T}]$|
|$v$|kinematic viscosity|NA|$[\frac{L^2}{T}]$|
|$V_d$|TKE viscous diffusion rate|NA|$[\frac{E}{M*T}]$|
|$v_K$|turbulence characteristic velocity scale|NA|$[\frac{L}{T}]$|
|$W$|Flow width|NA|$[L]$|




## References